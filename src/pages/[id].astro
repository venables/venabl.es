---
import { getCollection, getEntry, render } from "astro:content"
import Article from "@/components/articles/article.astro"
import Layout from "../layouts/layout.astro"

export async function getStaticPaths() {
  const allPosts = await getCollection("posts")
  return allPosts.map((post) => ({ params: { id: post.id } }))
}

async function getContent(id: string) {
  const entry = await getEntry("posts", id)
  if (!entry) {
    throw new Error(`Entry ${id} not found`)
  }

  const { Content } = await render(entry)
  return { entry, Content }
}

const { id } = Astro.params
const { entry, Content } = await getContent(id)
---

<Layout title={entry.data.title ?? "Untitled"} description={entry.data.description ?? ""}>
  <Article>
    {entry.data.pubDate && <time class="text-muted-foreground uppercase">{entry.data.pubDate.toDateString()}</time>}
    <Content />
  </Article>
</Layout>
