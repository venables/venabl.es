---
import { getCollection, getEntry, render } from "astro:content"
import Layout from "../layouts/Layout.astro"
import DecryptingText from "../components/DecryptingText.astro"

export async function getStaticPaths() {
  const allPosts = await getCollection("posts")
  return allPosts.map((post) => ({ params: { id: post.id } }))
}

const { id } = Astro.params

const entry = await getEntry("posts", id)
if (!entry) {
  return new Response(null, {
    status: 404,
    headers: {
      location: "/404"
    }
  })
}
const { Content } = await render(entry)
---

<Layout title={entry.data.title} description={entry.data.description}>
  <div class="flex flex-1 items-start space-x-4">
    <div class="w-full md:w-9/12">
      <article class="-mt-[5px] prose dark:prose-invert prose-base md:prose-sm">
        <time class="uppercase text-muted-foreground">
          {entry.data.date.toDateString()}
        </time>
        <h1
          class="flex items-start gap-2 font-display font-medium tracking-widest"
        >
          {entry.data.icon}
          <DecryptingText text={entry.data.title} />
        </h1>
        <Content />
      </article>
    </div>
  </div>
</Layout>
